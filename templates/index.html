<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading Bot Ultimate</title>
<script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
/* â”€â”€ Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --bg:       #0d0d0d;
  --bg2:      #141414;
  --panel:    #1a1a1a;
  --panel2:   #222222;
  --border:   #2a2a2a;
  --border2:  #333333;
  --text:     #e0e0e0;
  --muted:    #666666;
  --accent:   #4f8ef7;   /* bleu â€” ENTRY, scan actif        */
  --accent2:  #3570d4;
  --long:     #2dcc74;   /* vert â€” LONG, signal, TP         */
  --long-bg:  #0a1f12;
  --short:    #e84545;   /* rouge â€” SHORT, SL               */
  --short-bg: #200a0a;
  --warn:     #f5a623;   /* orange â€” TP1, avertissements    */
  --purple:   #9b7ef5;   /* violet â€” sniper M15/M30         */
  --radius:   10px;
  --rsm:      6px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
  font-size: 13px;
  line-height: 1.5;
  min-height: 100vh;
  overflow: hidden;
}
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOP BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar {
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  height: 50px;
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
}
.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: -.3px;
  color: #fff;
  white-space: nowrap;
}
.brand-pulse {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--long);
  box-shadow: 0 0 8px var(--long);
  animation: glow 2s ease-in-out infinite;
  flex-shrink: 0;
}
@keyframes glow {
  0%,100% { opacity:1; box-shadow:0 0 6px var(--long); }
  50%      { opacity:.4; box-shadow:0 0 2px var(--long); }
}
.brand em { color: var(--accent); font-style: normal; }

.topbar-stats {
  display: flex;
  align-items: center;
  gap: 0;
  margin-left: 16px;
  border-left: 1px solid var(--border);
  padding-left: 16px;
}
.tstat {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0 14px;
  border-right: 1px solid var(--border);
}
.tstat:last-child { border-right: none; padding-right: 0; }
.tstat-val   { font-size: 14px; font-weight: 700; color: #e0e8f5; line-height: 1.2; }
.tstat-label { font-size: 9px; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; margin-top: 1px; }
.tstat-val.g { color: var(--long); }
.tstat-val.r { color: var(--short); }
.tstat-val.b { color: var(--accent); }

.badge {
  font-size: 11px; font-weight: 600;
  padding: 4px 12px;
  border-radius: 20px;
  display: none;
}
.badge.running { background:#1e2a1e; color:var(--accent); border:1px solid #2a3a2a; display:inline; }
.badge.done    { background:var(--long-bg); color:var(--long); border:1px solid #1a4030; display:inline; }
.badge.error   { background:var(--short-bg); color:var(--short); border:1px solid #401a1a; display:inline; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTROLS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ctrlbar {
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  padding: 9px 20px;
  display: flex;
  align-items: center;
  gap: 18px;
  flex-wrap: wrap;
  height: 50px;
}
.clabel { font-size: 10px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: .6px; white-space: nowrap; }
select {
  background: var(--panel);
  color: var(--text);
  border: 1px solid var(--border2);
  border-radius: var(--rsm);
  padding: 5px 28px 5px 10px;
  font-size: 12px;
  font-family: inherit;
  cursor: pointer;
  outline: none;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%235c6e8a' stroke-width='2.5'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 8px center;
  transition: border-color .15s;
  min-width: 155px;
}
select:focus { border-color: var(--accent); }
.tf-group { display: flex; gap: 5px; }
.tf-lbl {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: var(--rsm);
  padding: 4px 10px;
  cursor: pointer;
  font-size: 11px;
  font-weight: 700;
  color: var(--muted);
  user-select: none;
  transition: all .15s;
}
.tf-lbl input { display: none; }
.tf-lbl.on { border-color: var(--accent); background: #1a1a1a; color: var(--accent); }
.tf-lbl:hover:not(.on) { border-color: var(--border2); }

#scan-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff;
  border: none;
  border-radius: var(--rsm);
  padding: 6px 20px;
  font-size: 12px;
  font-family: inherit;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(79,142,247,.3);
  transition: opacity .15s, transform .1s;
  white-space: nowrap;
  flex-shrink: 0;
}
#scan-btn:hover:not(:disabled) { opacity:.85; transform:translateY(-1px); }
#scan-btn:active:not(:disabled) { transform:translateY(0); }
#scan-btn:disabled { background:var(--panel2); color:var(--muted); box-shadow:none; cursor:not-allowed; }
#scan-btn.running {
  background: linear-gradient(135deg,#7a4d00,#f0a832);
  animation: btnshine 2s linear infinite;
}
@keyframes btnshine {
  0%,100% { box-shadow: 0 2px 10px rgba(240,168,50,.25); }
  50%      { box-shadow: 0 2px 18px rgba(240,168,50,.55); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.body-wrap {
  display: grid;
  grid-template-columns: 1fr 272px;
  height: calc(100vh - 100px);
  overflow: hidden;
}
.main-col {
  overflow-y: auto;
  padding: 14px 18px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}
.side-col {
  border-left: 1px solid var(--border);
  background: var(--bg2);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS PANEL â€” ORIGINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Header â”€â”€ */
.pg-header {
  padding: 12px 14px 8px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}
.pg-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .8px;
  color: var(--muted);
}
.pg-radar {
  width: 10px; height: 10px;
  border-radius: 50%;
  border: 1.5px solid var(--muted);
  position: relative;
  flex-shrink: 0;
}
.pg-radar::after {
  content: '';
  width: 4px; height: 4px;
  border-radius: 50%;
  background: var(--muted);
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
}
.pg-radar.active {
  border-color: var(--accent);
  box-shadow: 0 0 6px rgba(79,142,247,.5);
}
.pg-radar.active::after { background: var(--accent); }
.pg-radar.done { border-color: var(--long); }
.pg-radar.done::after { background: var(--long); }

.pg-pct {
  font-size: 18px;
  font-weight: 800;
  color: #e0e8f5;
  font-variant-numeric: tabular-nums;
  letter-spacing: -1px;
}
.pg-pct.active { color: var(--accent); }
.pg-pct.done   { color: var(--long); }

/* â”€â”€ Progress bar â”€â”€ */
.pg-bar-wrap { padding: 8px 14px 10px; }
.pg-track {
  height: 5px;
  background: var(--panel2);
  border-radius: 3px;
  overflow: hidden;
  position: relative;
}
.pg-fill {
  height: 100%;
  border-radius: 3px;
  width: 0%;
  transition: width .4s cubic-bezier(.4,0,.2,1);
  background: linear-gradient(90deg, var(--accent2), var(--accent), #7ab4ff);
  background-size: 200% 100%;
  position: relative;
}
.pg-fill.active {
  animation: fillshine 1.6s linear infinite;
}
.pg-fill.done {
  background: linear-gradient(90deg, #1a8050, var(--long), #5de0a0);
}
@keyframes fillshine {
  0%   { background-position: 100% 0%; }
  100% { background-position: -100% 0%; }
}
/* Glowing edge on the fill */
.pg-fill::after {
  content: '';
  position: absolute;
  right: 0; top: -1px;
  width: 12px; height: 7px;
  background: rgba(255,255,255,.5);
  border-radius: 50%;
  filter: blur(2px);
  opacity: 0;
}
.pg-fill.active::after { opacity: 1; }

/* â”€â”€ Mini stats â”€â”€ */
.pg-stats {
  display: flex;
  gap: 0;
  padding: 0 14px 10px;
  border-bottom: 1px solid var(--border);
}
.pg-stat {
  display: flex;
  align-items: baseline;
  gap: 4px;
  flex: 1;
  justify-content: center;
}
.pg-stat + .pg-stat { border-left: 1px solid var(--border); }
.pg-sv { font-size: 16px; font-weight: 800; color: #e0e8f5; font-variant-numeric: tabular-nums; line-height: 1; }
.pg-sv.g { color: var(--long); }
.pg-sv.r { color: var(--short); }
.pg-sl { font-size: 9px; color: var(--muted); text-transform: uppercase; letter-spacing: .4px; }

/* â”€â”€ Grid â”€â”€ */
.pg-grid-area {
  flex: 1;
  overflow-y: auto;
  padding: 8px 10px 6px;
}

/* TF header row */
.pg-tf-row {
  display: grid;
  gap: 3px;
  margin-bottom: 4px;
  padding-left: 68px;
}
.pg-tf-hdr {
  font-size: 9px;
  font-weight: 700;
  color: var(--muted);
  text-align: center;
  letter-spacing: .3px;
  text-transform: uppercase;
}

/* Pair row */
.pg-row {
  display: flex;
  align-items: center;
  gap: 3px;
  margin-bottom: 3px;
}
.pg-pair {
  font-size: 9px;
  font-weight: 600;
  color: var(--muted);
  width: 65px;
  flex-shrink: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.pg-cells {
  display: flex;
  gap: 3px;
  flex: 1;
}

/* Individual cell */
.pg-cell {
  flex: 1;
  height: 20px;
  border-radius: 3px;
  background: var(--panel);
  border: 1px solid var(--border);
  position: relative;
  transition: background .25s, border-color .25s, box-shadow .25s;
  cursor: default;
}
/* States */
.pg-cell[data-state="scanning"] {
  background: #111a22;
  border-color: var(--accent);
  box-shadow: 0 0 6px rgba(79,142,247,.35);
  animation: cellscan 1s ease-in-out infinite;
}
@keyframes cellscan {
  0%,100% { box-shadow: 0 0 4px rgba(79,142,247,.3); }
  50%      { box-shadow: 0 0 10px rgba(79,142,247,.65); }
}
.pg-cell[data-state="signal"] {
  background: var(--long-bg);
  border-color: var(--long);
  box-shadow: 0 0 6px rgba(37,196,122,.3);
}
.pg-cell[data-state="signal"]::after {
  content: 'âœ“';
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  color: var(--long);
  font-weight: 900;
}
.pg-cell[data-state="done"] {
  background: #131a28;
  border-color: #1c2840;
}
.pg-cell[data-state="error"] {
  background: #1e1000;
  border-color: #4a2a00;
}
.pg-cell[data-state="error"]::after {
  content: '!';
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  color: var(--warn);
  font-weight: 900;
}

/* Tooltip on hover */
.pg-cell[title]:hover {
  z-index: 10;
}

/* â”€â”€ Status line â”€â”€ */
.pg-status {
  border-top: 1px solid var(--border);
  padding: 8px 14px;
  display: flex;
  align-items: center;
  gap: 7px;
  min-height: 36px;
}
.pg-cursor {
  font-size: 10px;
  color: var(--accent);
  flex-shrink: 0;
  animation: blink 1.2s step-end infinite;
}
.pg-cursor.idle   { color: var(--muted); animation: none; }
.pg-cursor.done   { color: var(--long);  animation: none; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
#pg-status-text {
  font-size: 10px;
  color: var(--muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Elapsed timer */
.pg-elapsed {
  margin-left: auto;
  font-size: 10px;
  color: var(--border2);
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  flex-shrink: 0;
  font-family: 'Consolas', monospace;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN â€” TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section-hdr {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}
.section-title {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .8px;
  color: var(--muted);
}
#cnt {
  font-size: 10px;
  font-weight: 600;
  color: var(--accent);
  background: var(--panel2);
  border: 1px solid var(--border2);
  padding: 2px 10px;
  border-radius: 20px;
}
.tbl-scroll { overflow-x: auto; border-radius: var(--radius); border: 1px solid var(--border); }
table { width:100%; border-collapse:collapse; font-size:12px; }
thead th {
  background: var(--panel);
  color: var(--muted);
  text-align: left;
  padding: 8px 11px;
  border-bottom: 1px solid var(--border);
  font-weight: 600;
  font-size: 9.5px;
  text-transform: uppercase;
  letter-spacing: .5px;
  white-space: nowrap;
}
tbody tr {
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background .1s;
}
tbody tr:last-child { border-bottom: none; }
tbody tr:hover    { background: var(--panel); }
tbody tr.sel-row  { background: #222222 !important; }
tbody td { padding: 8px 11px; vertical-align: middle; white-space: nowrap; }

.dir-badge { display:inline-flex; align-items:center; gap:3px; padding:2px 8px; border-radius:20px; font-size:10px; font-weight:700; }
.dL { background:var(--long-bg);  color:var(--long);  border:1px solid rgba(37,196,122,.2); }
.dS { background:var(--short-bg); color:var(--short); border:1px solid rgba(232,69,69,.2); }
.dL::before { content:"â–²"; font-size:7px; }
.dS::before { content:"â–¼"; font-size:7px; }

.pair-cell { font-weight:700; color:#dce8fa; }
.tf-pill   { display:inline-block; background:var(--panel2); color:var(--muted); padding:2px 6px; border-radius:4px; font-size:9.5px; font-weight:700; border:1px solid var(--border); }
.tf-pill.sniper { background:#1a1030; color:var(--purple); border-color:rgba(155,137,245,.3); }
.pat-cell { color:#9fb0c8; }

.pe  { color:var(--accent); font-weight:600; font-variant-numeric:tabular-nums; }
.ps  { color:var(--short);  font-variant-numeric:tabular-nums; }
.pt1 { color:var(--warn);   font-variant-numeric:tabular-nums; }
.pt2 { color:var(--long);   font-weight:600; font-variant-numeric:tabular-nums; }
.prr { color:var(--muted);  font-variant-numeric:tabular-nums; }
.adx-ok  { color:var(--long);  font-weight:600; }
.adx-low { color:var(--muted); }

/* Score pips */
.score { display:inline-flex; align-items:center; gap:2.5px; }
.pip { width:7px; height:7px; border-radius:50%; background:var(--panel2); border:1px solid var(--border); }
.pip.on   { border:none; background:var(--accent); }
.pip.on.g { background:var(--long); }
.pip.on.w { background:var(--warn); }

.pine-btn { background:var(--panel2); color:var(--accent); border:1px solid var(--border2); padding:2px 8px; font-size:10px; font-weight:500; border-radius:4px; cursor:pointer; font-family:inherit; transition:all .15s; }
.pine-btn:hover { background:#1e2a1e; border-color:var(--accent); }
.pine-btn.ok { background:var(--long-bg); color:var(--long); border-color:var(--long); }

.empty { text-align:center; padding:48px 20px; color:var(--muted); }
.empty-ico { font-size:28px; opacity:.5; margin-bottom:10px; }
.empty-t   { font-size:13px; font-weight:600; color:var(--text); margin-bottom:5px; }
.empty-s   { font-size:11px; color:var(--muted); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#chart-section { display:none; border-radius:var(--radius); border:1px solid var(--border); overflow:hidden; }
.chart-hdr {
  background: var(--panel);
  padding: 9px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}
.chart-meta { display:flex; align-items:center; gap:10px; }
.chart-pair { font-size:14px; font-weight:700; color:#fff; }
.chart-tf   { background:var(--panel2); color:var(--muted); padding:2px 7px; border-radius:4px; font-size:10px; font-weight:600; }
.chart-lvls { display:flex; gap:10px; font-size:11px; }
.chart-lvls .el { color:var(--accent); }
.chart-lvls .sl { color:var(--short); }
.chart-lvls .tp { color:var(--long); }
.close-btn { background:none; border:1px solid var(--border2); color:var(--muted); padding:3px 11px; font-size:11px; font-weight:500; border-radius:var(--rsm); cursor:pointer; font-family:inherit; transition:all .15s; }
.close-btn:hover { border-color:var(--short); color:var(--short); }
#chart-box { background:var(--bg); height:440px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 960px) {
  body { overflow: auto; }
  .body-wrap { grid-template-columns:1fr; height:auto; overflow:visible; }
  .side-col  { border-left:none; border-top:1px solid var(--border); height:300px; }
  .topbar-stats { display:none; }
}
@media (max-width: 620px) {
  .ctrlbar { height:auto; padding:8px 12px; }
  .main-col { padding:10px 12px; }
  thead th:nth-child(7), thead th:nth-child(8),
  thead th:nth-child(9), thead th:nth-child(11) { display:none; }
  tbody td:nth-child(7), tbody td:nth-child(8),
  tbody td:nth-child(9), tbody td:nth-child(11) { display:none; }
  #chart-box { height:300px; }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â• TOP BAR â•â•â•â•â•â•â•â•â•â•â• -->
<header class="topbar">
  <div style="display:flex;align-items:center;gap:0">
    <div class="brand">
      <div class="brand-pulse"></div>
      Trading<em>Bot</em>&nbsp;Ultimate
    </div>
    <div class="topbar-stats">
      <div class="tstat"><span class="tstat-val b" id="s-total">0</span><span class="tstat-label">signaux</span></div>
      <div class="tstat"><span class="tstat-val g" id="s-long">0</span><span class="tstat-label">long</span></div>
      <div class="tstat"><span class="tstat-val r" id="s-short">0</span><span class="tstat-label">short</span></div>
      <div class="tstat"><span class="tstat-val"   id="s-top">â€”</span><span class="tstat-label">top paire</span></div>
    </div>
  </div>
  <span class="badge" id="badge"></span>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â• CONTROLS â•â•â•â•â•â•â•â•â•â•â• -->
<div class="ctrlbar">
  <div style="display:flex;align-items:center;gap:8px">
    <span class="clabel">Paire</span>
    <select id="pair-sel">
      <option value="">Toutes les paires</option>
      {% for pair in pairs %}<option value="{{ pair }}">{{ pair }}</option>{% endfor %}
    </select>
  </div>
  <div style="display:flex;align-items:center;gap:8px">
    <span class="clabel">TF</span>
    <div class="tf-group">
      {% for tf in timeframes %}
      <label class="tf-lbl on" id="tfl-{{ tf }}">
        <input type="checkbox" value="{{ tf }}" checked onchange="toggleTF(this)">{{ tf }}
      </label>
      {% endfor %}
    </div>
  </div>
  <button id="scan-btn" onclick="startScan()">&#x1F50D;&nbsp; Lancer le scan</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• BODY â•â•â•â•â•â•â•â•â•â•â• -->
<div class="body-wrap">

  <!-- Main column -->
  <div class="main-col">

    <!-- Chart (hidden by default) -->
    <div id="chart-section">
      <div class="chart-hdr">
        <div class="chart-meta">
          <span class="chart-pair" id="chart-pair">â€”</span>
          <span class="chart-tf"   id="chart-tf">â€”</span>
          <div class="chart-lvls"  id="chart-lvls"></div>
        </div>
        <button class="close-btn" onclick="closeChart()">&#x2715; Fermer</button>
      </div>
      <div id="chart-box"></div>
    </div>

    <!-- Signals table -->
    <div>
      <div class="section-hdr">
        <span class="section-title">Signaux dÃ©tectÃ©s</span>
        <span id="cnt">0 signal</span>
      </div>
      <div class="tbl-scroll">
        <table>
          <thead><tr>
            <th>Paire</th><th>TF</th><th>Pattern</th><th>Direction</th>
            <th>Score</th><th>EntrÃ©e</th><th>SL</th><th>TP1</th><th>TP2</th>
            <th>RR</th><th>ADX</th><th>Pine</th>
          </tr></thead>
          <tbody id="tbody">
            <tr><td colspan="12"><div class="empty">
              <div class="empty-ico">&#x1F50D;</div>
              <div class="empty-t">Aucun scan lancÃ©</div>
              <div class="empty-s">Configure tes paramÃ¨tres puis clique sur "Lancer le scan"</div>
            </div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div><!-- /main-col -->

  <!-- Sidebar â€” Progress Panel -->
  <div class="side-col">

    <!-- Header -->
    <div class="pg-header">
      <div class="pg-title">
        <div class="pg-radar" id="pg-radar"></div>
        Scan Progress
      </div>
      <span class="pg-pct" id="pg-pct">â€”</span>
    </div>

    <!-- Bar -->
    <div class="pg-bar-wrap">
      <div class="pg-track">
        <div class="pg-fill" id="pg-fill" style="width:0%"></div>
      </div>
    </div>

    <!-- Stats -->
    <div class="pg-stats">
      <div class="pg-stat">
        <span class="pg-sv" id="pg-scanned">0</span>
        <span class="pg-sl">scannÃ©s</span>
      </div>
      <div class="pg-stat">
        <span class="pg-sv g" id="pg-signals">0</span>
        <span class="pg-sl">signaux</span>
      </div>
      <div class="pg-stat">
        <span class="pg-sv" id="pg-total">0</span>
        <span class="pg-sl">total</span>
      </div>
    </div>

    <!-- Pair Ã— TF grid -->
    <div class="pg-grid-area">
      <div class="pg-tf-row" id="pg-tf-row"></div>
      <div id="pg-grid"></div>
    </div>

    <!-- Status line -->
    <div class="pg-status">
      <span class="pg-cursor idle" id="pg-cursor">â—‰</span>
      <span id="pg-status-text">En attente du scan...</span>
      <span class="pg-elapsed" id="pg-elapsed"></span>
    </div>

  </div><!-- /side-col -->

</div><!-- /body-wrap -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let scanId   = null;
let es       = null;
let scanning = false;
let activeRow = null;
let chartInstance = null;

// Progress state
const pg = {
  pairs:    [],   // pairs in scan
  tfs:      [],   // TFs in scan
  total:    0,    // total cells
  scanned:  0,    // cells processed
  signals:  0,    // signals found
  filtered: 0,
  curPair:  null,
  curTf:    null,
  timer:    null,
  startMs:  0,
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TF TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleTF(cb) {
  cb.parentElement.classList.toggle("on", cb.checked);
}
function getTFs() {
  return [...document.querySelectorAll(".tf-group input:checked")].map(c => c.value);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGE / BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setBadge(state, txt) {
  const b = document.getElementById("badge");
  b.className = "badge " + state;
  b.textContent = txt;
}
function resetBtn() {
  scanning = false;
  const b = document.getElementById("scan-btn");
  b.disabled = false;
  b.innerHTML = "&#x1F50D;&nbsp; Lancer le scan";
  b.classList.remove("running");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOP STATS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateTopStats(sigs) {
  const longs  = sigs.filter(s => s.direction === "LONG").length;
  const shorts = sigs.length - longs;
  const pmap   = {};
  sigs.forEach(s => pmap[s.pair] = (pmap[s.pair] || 0) + 1);
  const top = Object.entries(pmap).sort((a,b) => b[1]-a[1])[0];
  document.getElementById("s-total").textContent = sigs.length;
  document.getElementById("s-long").textContent  = longs;
  document.getElementById("s-short").textContent = shorts;
  document.getElementById("s-top").textContent   = top ? top[0] : "â€”";
  document.getElementById("cnt").textContent     = sigs.length + " signal" + (sigs.length > 1 ? "s" : "");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildGrid(pairs, tfs) {
  pg.pairs   = pairs;
  pg.tfs     = tfs;
  pg.total   = pairs.length * tfs.length;
  pg.scanned = 0;
  pg.signals = 0;
  pg.filtered= 0;
  pg.curPair = null;
  pg.curTf   = null;

  // TF header row
  const hdr = document.getElementById("pg-tf-row");
  hdr.style.gridTemplateColumns = `repeat(${tfs.length}, 1fr)`;
  hdr.innerHTML = tfs.map(tf =>
    `<span class="pg-tf-hdr">${tf}</span>`
  ).join("");

  // Pair rows
  const grid = document.getElementById("pg-grid");
  grid.innerHTML = pairs.map(pair => {
    const cells = tfs.map(tf =>
      `<div class="pg-cell" id="cell-${cellId(pair,tf)}" data-state="empty" data-pair="${pair}" data-tf="${tf}" title="${pair} | ${tf}"></div>`
    ).join("");
    const shortPair = pair.replace("/","");
    return `<div class="pg-row">
      <span class="pg-pair" title="${pair}">${shortPair}</span>
      <div class="pg-cells">${cells}</div>
    </div>`;
  }).join("");

  // Stats reset
  document.getElementById("pg-scanned").textContent = "0";
  document.getElementById("pg-signals").textContent = "0";
  document.getElementById("pg-total").textContent   = pg.total;
  document.getElementById("pg-pct").textContent     = "0%";
  document.getElementById("pg-pct").className       = "pg-pct active";

  // Bar
  const fill = document.getElementById("pg-fill");
  fill.style.width = "0%";
  fill.className   = "pg-fill active";

  // Radar
  document.getElementById("pg-radar").className = "pg-radar active";

  // Cursor
  document.getElementById("pg-cursor").className   = "pg-cursor";
  document.getElementById("pg-status-text").textContent = "Initialisation...";
  document.getElementById("pg-elapsed").textContent = "00:00";

  // Timer
  pg.startMs = Date.now();
  if (pg.timer) clearInterval(pg.timer);
  pg.timer = setInterval(updateTimer, 1000);
}

function updateTimer() {
  const s = Math.floor((Date.now() - pg.startMs) / 1000);
  const mm = String(Math.floor(s / 60)).padStart(2, "0");
  const ss = String(s % 60).padStart(2, "0");
  document.getElementById("pg-elapsed").textContent = `${mm}:${ss}`;
}

function cellId(pair, tf) {
  return (pair + "_" + tf).replace(/[^a-zA-Z0-9]/g, "_");
}

function setCellState(pair, tf, state) {
  const el = document.getElementById("cell-" + cellId(pair, tf));
  if (el) el.dataset.state = state;
}

function setCurrent(pair, tf) {
  // Mark previous cell as done
  if (pg.curPair && pg.curTf) {
    const prev = document.getElementById("cell-" + cellId(pg.curPair, pg.curTf));
    if (prev && prev.dataset.state === "scanning") {
      prev.dataset.state = "done";
      pg.scanned++;
      updatePgStats();
    }
  }
  pg.curPair = pair;
  pg.curTf   = tf;
  setCellState(pair, tf, "scanning");
  document.getElementById("pg-status-text").textContent = `${pair} | ${tf}`;
}

function markCurrentSignal() {
  if (pg.curPair && pg.curTf) {
    setCellState(pg.curPair, pg.curTf, "signal");
    pg.scanned++;
    pg.signals++;
    pg.curPair = null; pg.curTf = null;
    updatePgStats();
  }
}

function markCurrentError() {
  if (pg.curPair && pg.curTf) {
    setCellState(pg.curPair, pg.curTf, "error");
    pg.scanned++;
    pg.curPair = null; pg.curTf = null;
    updatePgStats();
  }
}

function updatePgStats() {
  document.getElementById("pg-scanned").textContent = pg.scanned;
  document.getElementById("pg-signals").textContent = pg.signals;
  const pct = pg.total ? Math.round(pg.scanned / pg.total * 100) : 0;
  document.getElementById("pg-pct").textContent = pct + "%";
  document.getElementById("pg-fill").style.width = pct + "%";
}

function finishProgress() {
  // Mark last scanning cell as done
  if (pg.curPair && pg.curTf) {
    const el = document.getElementById("cell-" + cellId(pg.curPair, pg.curTf));
    if (el && el.dataset.state === "scanning") {
      el.dataset.state = "done";
      pg.scanned++;
    }
    pg.curPair = null; pg.curTf = null;
  }
  // Fill all remaining empty as done
  document.querySelectorAll(".pg-cell[data-state='empty']").forEach(el => {
    el.dataset.state = "done";
  });
  document.querySelectorAll(".pg-cell[data-state='scanning']").forEach(el => {
    el.dataset.state = "done";
  });

  // 100%
  document.getElementById("pg-pct").textContent = "100%";
  document.getElementById("pg-pct").className   = "pg-pct done";
  document.getElementById("pg-fill").style.width = "100%";
  document.getElementById("pg-fill").className  = "pg-fill done";
  document.getElementById("pg-radar").className = "pg-radar done";
  document.getElementById("pg-cursor").className = "pg-cursor done";
  document.getElementById("pg-status-text").textContent = "Scan terminÃ©";

  if (pg.timer) { clearInterval(pg.timer); pg.timer = null; }
}

function parseLogForProgress(msg) {
  // Detect pair|tf scanning start: "  ğŸ“Š EUR/USD | 1h"
  const mScan = msg.match(/ğŸ“Š\s+([A-Z/]+)\s+\|\s+(\w+)/);
  if (mScan) {
    setCurrent(mScan[1], mScan[2]);
    return;
  }
  // Detect signal found
  if (msg.includes("SIGNAL") || msg.includes("âœ…") || msg.includes("SNIPER")) {
    markCurrentSignal();
    return;
  }
  // Detect no data / error
  if (msg.includes("DonnÃ©es insuffisantes") || msg.includes("ERROR") || msg.includes("Erreur")) {
    markCurrentError();
    return;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCAN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function startScan() {
  if (scanning) return;
  const pair = document.getElementById("pair-sel").value;
  const tfs  = getTFs();
  if (!tfs.length) { alert("SÃ©lectionne au moins un timeframe !"); return; }

  scanning = true;
  const btn = document.getElementById("scan-btn");
  btn.disabled = true;
  btn.innerHTML = "&#9696;&nbsp; Scan en cours...";
  btn.classList.add("running");
  setBadge("running", "Scan en cours...");

  // Determine pairs to scan
  const allPairs = [...document.querySelectorAll("#pair-sel option")].map(o => o.value).filter(v => v);
  const scanPairs = pair ? [pair] : allPairs;

  // Build progress grid
  buildGrid(scanPairs, tfs);
  clearTable();

  try {
    const r = await fetch("/api/scan", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ pairs: pair ? [pair] : [], timeframes: tfs })
    });
    const d = await r.json();
    scanId = d.scan_id;
    document.getElementById("pg-status-text").textContent = `ID: ${scanId.slice(0,8)}â€¦`;
    openSSE(scanId);
  } catch(e) {
    setBadge("error", "Erreur rÃ©seau");
    document.getElementById("pg-status-text").textContent = "Erreur : " + e.message;
    document.getElementById("pg-cursor").className = "pg-cursor idle";
    resetBtn();
  }
}

function openSSE(id) {
  if (es) { es.close(); es = null; }
  es = new EventSource(`/api/stream/${id}`);
  es.onmessage = function(ev) {
    const m = ev.data;
    if (m === "__SCAN_DONE__") {
      es.close(); es = null;
      fetchResults(id);
    } else if (m !== "__HEARTBEAT__") {
      parseLogForProgress(m);
    }
  };
  es.onerror = function() {
    if (es) { es.close(); es = null; }
    fetchResults(id);
  };
}

async function fetchResults(id) {
  try {
    const r = await fetch(`/api/results/${id}`);
    const d = await r.json();
    finishProgress();
    if (d.status === "error") {
      setBadge("error", "Erreur");
      document.getElementById("pg-status-text").textContent = "Erreur : " + d.error;
    } else {
      setBadge("done", `${d.count} signal(s)`);
      // Mark signal cells green from real results
      if (d.signals) {
        d.signals.forEach(s => setCellState(s.pair, s.timeframe, "signal"));
        document.getElementById("pg-signals").textContent = d.signals.length;
      }
      renderTable(d.signals || []);
      updateTopStats(d.signals || []);
    }
  } catch(e) {
    setBadge("error", "Erreur");
    document.getElementById("pg-status-text").textContent = "Erreur chargement";
  } finally {
    resetBtn();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function clearTable() {
  document.getElementById("tbody").innerHTML =
    `<tr><td colspan="12"><div class="empty">
      <div class="empty-ico">&#x23F3;</div>
      <div class="empty-t">Scan en cours...</div>
      <div class="empty-s">Les signaux apparaÃ®tront ici dÃ¨s la fin du scan</div>
    </div></td></tr>`;
  document.getElementById("cnt").textContent = "0 signal";
  document.getElementById("s-total").textContent = "0";
  document.getElementById("s-long").textContent  = "0";
  document.getElementById("s-short").textContent = "0";
  document.getElementById("s-top").textContent   = "â€”";
}

function scorePips(val, max) {
  let h = '<span class="score">';
  for (let i = 0; i < max; i++) {
    let c = "pip";
    if (i < val) {
      c += " on";
      if (val >= max * .75) c += " g";
      else if (val <= max * .375) c += " w";
    }
    h += `<span class="${c}"></span>`;
  }
  return h + "</span>";
}

function renderTable(sigs) {
  if (!sigs.length) {
    document.getElementById("tbody").innerHTML =
      `<tr><td colspan="12"><div class="empty">
        <div class="empty-ico">&#x1F6AB;</div>
        <div class="empty-t">Aucun signal</div>
        <div class="empty-s">Aucun signal valide sur cette sÃ©lection</div>
      </div></td></tr>`;
    return;
  }
  document.getElementById("tbody").innerHTML = sigs.map((s, i) => {
    const isSniper = s.timeframe === "15m" || s.timeframe === "30m";
    const dir  = s.direction === "LONG"
      ? `<span class="dir-badge dL">LONG</span>`
      : `<span class="dir-badge dS">SHORT</span>`;
    const tfpill = `<span class="tf-pill${isSniper ? " sniper" : ""}">${s.timeframe}</span>`;
    const comp = s.compression ? " &#x1F525;" : "";
    const m    = (s.confluence || "").match(/(\d+)\/(\d+)/);
    const sv   = m ? parseInt(m[1]) : 0;
    const sm   = m ? parseInt(m[2]) : 8;
    const adx  = s.adx >= 20
      ? `<span class="adx-ok">${s.adx}</span>`
      : `<span class="adx-low">${s.adx}</span>`;
    const pine = s.pine_file
      ? `<button class="pine-btn" onclick="event.stopPropagation();copyPine('${s.pine_file.split('/').pop()}',this)">Pine</button>`
      : "â€”";
    return `<tr data-i="${i}" onclick="selectRow(this,'${s.pair}','${s.timeframe}',${s.entry},${s.sl},${s.tp1},${s.tp2},'${s.pattern||""}',${s.zone_high},${s.zone_low},'${s.direction}')">
      <td class="pair-cell">${s.pair}</td>
      <td>${tfpill}</td>
      <td class="pat-cell">${s.pattern||"â€”"}${comp}</td>
      <td>${dir}</td>
      <td>${scorePips(sv, sm)}</td>
      <td class="pe">${s.entry}</td>
      <td class="ps">${s.sl}</td>
      <td class="pt1">${s.tp1}</td>
      <td class="pt2">${s.tp2}</td>
      <td class="prr">1:${s.rr_ratio}</td>
      <td>${adx}</td>
      <td>${pine}</td>
    </tr>`;
  }).join("");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function selectRow(tr, pair, tf, entry, sl, tp1, tp2, pattern, zh, zl, dir) {
  if (activeRow) activeRow.classList.remove("sel-row");
  tr.classList.add("sel-row");
  activeRow = tr;
  showChart(pair, tf, entry, sl, tp1, tp2, pattern, zh, zl, dir);
}

function showChart(pair, tf, entry, sl, tp1, tp2, pattern, zoneHigh, zoneLow, direction) {
  const sec = document.getElementById("chart-section");
  sec.style.display = "block";
  document.getElementById("chart-pair").textContent = pair;
  document.getElementById("chart-tf").textContent   = tf;
  document.getElementById("chart-lvls").innerHTML   =
    `<span class="el">E: ${entry}</span><span class="sl">SL: ${sl}</span><span class="tp">TP1: ${tp1}</span><span class="tp">TP2: ${tp2}</span>`;
  sec.scrollIntoView({ behavior: "smooth", block: "start" });

  if (chartInstance) { chartInstance.remove(); chartInstance = null; }
  const box = document.getElementById("chart-box");
  box.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted);font-size:12px">Chargement...</div>`;

  fetch(`/api/chart?pair=${encodeURIComponent(pair)}&timeframe=${tf}`)
    .then(r => r.json())
    .then(d => {
      if (d.error) { box.innerHTML = `<div style="padding:20px;color:var(--short)">${d.error}</div>`; return; }
      box.innerHTML = "";
      chartInstance = LightweightCharts.createChart(box, {
        layout    : { background:{ color:"#080c14" }, textColor:"#7a8fa8" },
        grid      : { vertLines:{ color:"#1a1a1a" }, horzLines:{ color:"#1a1a1a" } },
        crosshair : { mode: LightweightCharts.CrosshairMode.Normal },
        rightPriceScale: { borderColor:"#2a2a2a" },
        timeScale : { borderColor:"#2a2a2a", timeVisible:true },
        width     : box.clientWidth,
        height    : 440,
      });
      const series = chartInstance.addCandlestickSeries({
        upColor:"#25c47a", downColor:"#e84545",
        borderUpColor:"#25c47a", borderDownColor:"#e84545",
        wickUpColor:"#25c47a",   wickDownColor:"#e84545",
      });
      series.setData(d.candles);
      series.createPriceLine({ price:entry, color:"#4f8ef7", lineWidth:2, lineStyle:0, title:"ENTRY" });
      series.createPriceLine({ price:sl,    color:"#e84545", lineWidth:1, lineStyle:2, title:"SL"    });
      series.createPriceLine({ price:tp1,   color:"#f0a832", lineWidth:1, lineStyle:2, title:"TP1"   });
      series.createPriceLine({ price:tp2,   color:"#25c47a", lineWidth:1, lineStyle:0, title:"TP2"   });
      if (zoneHigh > 0 && zoneLow > 0 && zoneHigh !== zoneLow) {
        const bc = direction === "LONG" ? "#25c47a" : "#e84545";
        series.createPriceLine({ price:zoneHigh, color:bc, lineWidth:2, lineStyle:3, title:`â–² ${pattern||"Zone"}` });
        series.createPriceLine({ price:zoneLow,  color:bc, lineWidth:2, lineStyle:3, title:"â–¼ Zone" });
      }
      chartInstance.timeScale().fitContent();
      new ResizeObserver(() => { if (chartInstance) chartInstance.applyOptions({ width:box.clientWidth }); }).observe(box);
    })
    .catch(e => { box.innerHTML = `<div style="padding:20px;color:var(--short)">Erreur : ${e.message}</div>`; });
}

function closeChart() {
  document.getElementById("chart-section").style.display = "none";
  if (chartInstance) { chartInstance.remove(); chartInstance = null; }
  if (activeRow) { activeRow.classList.remove("sel-row"); activeRow = null; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PINE COPY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function copyPine(name, btn) {
  try {
    const r = await fetch(`/pine/${name}`);
    if (!r.ok) { alert("Fichier Pine introuvable."); return; }
    await navigator.clipboard.writeText(await r.text());
    btn.textContent = "CopiÃ© !"; btn.classList.add("ok");
    setTimeout(() => { btn.textContent = "Pine"; btn.classList.remove("ok"); }, 2000);
  } catch(e) { alert("Erreur : " + e.message); }
}
</script>
</body>
</html>
